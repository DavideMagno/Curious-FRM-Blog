<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.54.0 with theme Tranquilpeak 0.4.3-SNAPSHOT">
<meta name="author" content="Davide Magno">
<meta name="keywords" content="tech">
<meta name="description" content="In this post we will close the trilogy on (old style) swap pricing. In particular, we will look at how downloading the data for the variable rate needed to calculate the variable leg accrual.
 Part 1 gave the general idea behind tidy pricing interest rate swaps using a 7 lines pipe
 Part 2 went much more into detail and priced some real world contract comparing the results obtained vs Bloomberg and showing significantly good results.">


<meta property="og:description" content="In this post we will close the trilogy on (old style) swap pricing. In particular, we will look at how downloading the data for the variable rate needed to calculate the variable leg accrual.
 Part 1 gave the general idea behind tidy pricing interest rate swaps using a 7 lines pipe
 Part 2 went much more into detail and priced some real world contract comparing the results obtained vs Bloomberg and showing significantly good results.">
<meta property="og:type" content="article">
<meta property="og:title" content="Pricing floating legs of interest rate swaps">
<meta name="twitter:title" content="Pricing floating legs of interest rate swaps">
<meta property="og:url" content="/2019/07/downloading-variable-rate/">
<meta property="twitter:url" content="/2019/07/downloading-variable-rate/">
<meta property="og:site_name" content="The CuRious Financial Risk ManageR">
<meta property="og:description" content="In this post we will close the trilogy on (old style) swap pricing. In particular, we will look at how downloading the data for the variable rate needed to calculate the variable leg accrual.
 Part 1 gave the general idea behind tidy pricing interest rate swaps using a 7 lines pipe
 Part 2 went much more into detail and priced some real world contract comparing the results obtained vs Bloomberg and showing significantly good results.">
<meta name="twitter:description" content="In this post we will close the trilogy on (old style) swap pricing. In particular, we will look at how downloading the data for the variable rate needed to calculate the variable leg accrual.
 Part 1 gave the general idea behind tidy pricing interest rate swaps using a 7 lines pipe
 Part 2 went much more into detail and priced some real world contract comparing the results obtained vs Bloomberg and showing significantly good results.">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2019-07-08T00:00:00">
  
  
    <meta property="article:modified_time" content="2019-07-08T00:00:00">
  
  
  
    
      <meta property="article:section" content="Finance">
    
  
  
    
      <meta property="article:tag" content="Coding">
    
      <meta property="article:tag" content="Interest Rates">
    
      <meta property="article:tag" content="R">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@DavideMagno">


  <meta name="twitter:creator" content="@DavideMagno">










  <meta property="og:image" content="https://www.gravatar.com/avatar/c1105417b6cb80bccd4bb80937e0ec69?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/c1105417b6cb80bccd4bb80937e0ec69?s=640">


    <title>Pricing floating legs of interest rate swaps</title>

    <link rel="icon" href="/favicon.png">
    

    

    <link rel="canonical" href="/2019/07/downloading-variable-rate/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="/css/style-nnm2spxvve8onlujjlegkkytaehyadd4ksxc1hyzzq9a2wvtrgbljqyulomn.min.css" />
    
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-137185358-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/">The CuRious Financial Risk ManageR</a>
  </div>
  
    
      <a class="header-right-picture "
         href="/#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/c1105417b6cb80bccd4bb80937e0ec69?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/c1105417b6cb80bccd4bb80937e0ec69?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Davide Magno</h4>
        
          <h5 class="sidebar-profile-bio">An Italian coding, tech, financial math professional and running lover</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="mailto:davide.magno@gmail.com" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-envelope"></i>
      
      <span class="sidebar-button-desc">Contact</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/#about/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/davidemagno/">
    
      <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
      
      <span class="sidebar-button-desc">LinkedIn</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/DavideMagno">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/DavideMagno">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.r-bloggers.com">
    
      <i class="sidebar-button-icon fa fa-lg fa-external-link"></i>
      
      <span class="sidebar-button-desc">R-Bloggers</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="5"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Pricing floating legs of interest rate swaps
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2019-07-08T00:00:00Z">
        
  
  
  
  
    8 July 2019
  

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="/categories/finance">Finance</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              
<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<p>In this post we will close the trilogy on (old style) swap pricing. In particular, we will look at how downloading the data for the variable rate needed to calculate the variable leg accrual.</p>
<ul>
<li><p><a href="https://www.curiousfrm.com/2019/03/using-the-tidyverse-for-swap-pricing/">Part 1</a>
gave the general idea behind tidy pricing interest rate swaps using a 7 lines
pipe</p></li>
<li><p><a href="https://www.curiousfrm.com/2019/04/real-world-tidy-interest-rate-swap-pricing/">Part 2</a>
went much more into detail and priced some real world contract comparing the results
obtained vs Bloomberg and showing significantly good results.</p></li>
</ul>
<p>The only part missing was calculating the accrual for the floating leg. To do this
we need the information about the historical level of the interest rate to which the leg
is linked.</p>
<p>For standard EUR contracts, this rate is the 6 months’ EURIBOR. For those of you
who are interested in understanding more what this rate is can go <a href="https://www.euribor-rates.eu/what-is-euribor.asp">this link</a></p>
<p>Sourcing the data is not a problem, but doing it the <code>R</code> way (ie. for free), can be.</p>
<p>Luckily the awesome <a href="https://www.quandl.com/">Quandl</a> data provider actually
provides the information we need. <em>Quandl</em> is a premier source for financial, economic, and alternative datasets, serving investment professionals. Quandl’s platform is used by over 400,000 people, including analysts from the world’s top hedge funds, asset managers and investment banks.</p>
<p>Pulling data from Quandl is very easy using the <code>Quandl</code> package available on <em>CRAN</em>
Its logic is quite simple:</p>
<pre class="r"><code>Quandl::Quandl(code, start_date, end_date)</code></pre>
<p>where <em>code</em> is a unique identifier that can be sourced from the Quandl website.</p>
<p>In particular, we shoudl be grateful to the <em>Bank of France</em> which provides all
the interest rate information we need. Going on their
<a href="https://www.quandl.com/data/BOF-Bank-of-France">page</a> we can in fact find that
the code for the 6 months EURIBOR rate is “BOF/QS_D_IEUTIO6M”.</p>
<p>Let’s then see what the output of this very simple function is with our code:</p>
<pre class="r"><code>rates &lt;- Quandl::Quandl(&quot;BOF/QS_D_IEUTIO6M&quot;, 
               start_date = lubridate::dmy(&quot;01-01-2018&quot;), 
               end_date = lubridate::dmy(&quot;31-12-2018&quot;))

rates %&gt;% 
  knitr::kable(caption = &quot;Output from Quandl&quot;, &quot;html&quot;) %&gt;% 
  kableExtra::kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;)) %&gt;% 
   kableExtra::scroll_box(height = &quot;500px&quot;)</code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; ">
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-2">Table 1: </span>Output from Quandl
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Date
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2018-12-31
</td>
<td style="text-align:right;">
-0.237
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-27
</td>
<td style="text-align:right;">
-0.237
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-24
</td>
<td style="text-align:right;">
-0.237
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-21
</td>
<td style="text-align:right;">
-0.238
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-20
</td>
<td style="text-align:right;">
-0.238
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-19
</td>
<td style="text-align:right;">
-0.238
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-18
</td>
<td style="text-align:right;">
-0.238
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-17
</td>
<td style="text-align:right;">
-0.237
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-14
</td>
<td style="text-align:right;">
-0.238
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-13
</td>
<td style="text-align:right;">
-0.239
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-12
</td>
<td style="text-align:right;">
-0.241
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-11
</td>
<td style="text-align:right;">
-0.244
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-10
</td>
<td style="text-align:right;">
-0.245
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-07
</td>
<td style="text-align:right;">
-0.246
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-06
</td>
<td style="text-align:right;">
-0.246
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-05
</td>
<td style="text-align:right;">
-0.246
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-04
</td>
<td style="text-align:right;">
-0.247
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-12-03
</td>
<td style="text-align:right;">
-0.248
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-30
</td>
<td style="text-align:right;">
-0.251
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-29
</td>
<td style="text-align:right;">
-0.253
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-28
</td>
<td style="text-align:right;">
-0.256
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-27
</td>
<td style="text-align:right;">
-0.256
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-26
</td>
<td style="text-align:right;">
-0.256
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-23
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-22
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-21
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-20
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-19
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-16
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-15
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-14
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-13
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-12
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-09
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-08
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-07
</td>
<td style="text-align:right;">
-0.258
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-06
</td>
<td style="text-align:right;">
-0.258
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-05
</td>
<td style="text-align:right;">
-0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-02
</td>
<td style="text-align:right;">
-0.258
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-11-01
</td>
<td style="text-align:right;">
-0.258
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-31
</td>
<td style="text-align:right;">
-0.259
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-30
</td>
<td style="text-align:right;">
-0.259
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-29
</td>
<td style="text-align:right;">
-0.259
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-26
</td>
<td style="text-align:right;">
-0.259
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-25
</td>
<td style="text-align:right;">
-0.259
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-24
</td>
<td style="text-align:right;">
-0.259
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-23
</td>
<td style="text-align:right;">
-0.259
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-22
</td>
<td style="text-align:right;">
-0.261
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-19
</td>
<td style="text-align:right;">
-0.262
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-18
</td>
<td style="text-align:right;">
-0.265
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-17
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-16
</td>
<td style="text-align:right;">
-0.265
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-15
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-12
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-11
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-10
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-09
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-08
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-05
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-04
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-03
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-02
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-10-01
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-28
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-27
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-26
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-25
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-24
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-21
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-20
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-19
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-18
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-17
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-14
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-13
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-12
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-11
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-10
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-07
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-06
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-05
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-04
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-09-03
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-31
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-30
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-29
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-28
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-27
</td>
<td style="text-align:right;">
-0.265
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-24
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-23
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-22
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-21
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-20
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-17
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-16
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-15
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-14
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-13
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-10
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-09
</td>
<td style="text-align:right;">
-0.266
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-08
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-07
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-06
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-03
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-02
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-08-01
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-31
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-30
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-27
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-26
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-25
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-24
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-23
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-20
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-19
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-18
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-17
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-16
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-13
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-12
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-11
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-10
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-09
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-06
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-05
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-04
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-03
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-07-02
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-29
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-28
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-27
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-26
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-25
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-22
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-21
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-20
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-19
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-18
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-15
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-14
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-13
</td>
<td style="text-align:right;">
-0.268
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-12
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-11
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-08
</td>
<td style="text-align:right;">
-0.267
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-07
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-06
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-05
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-04
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-06-01
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-31
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-30
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-29
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-28
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-25
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-24
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-23
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-22
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-18
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-17
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-16
</td>
<td style="text-align:right;">
-0.272
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-15
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-14
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-11
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-10
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-09
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-08
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-07
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-04
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-03
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-05-02
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-30
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-27
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-26
</td>
<td style="text-align:right;">
-0.269
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-25
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-24
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-23
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-20
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-19
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-18
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-17
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-16
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-13
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-12
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-11
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-10
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-09
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-06
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-05
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-04
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-04-03
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-29
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-28
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-27
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-26
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-23
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-22
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-21
</td>
<td style="text-align:right;">
-0.272
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-20
</td>
<td style="text-align:right;">
-0.273
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-19
</td>
<td style="text-align:right;">
-0.272
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-16
</td>
<td style="text-align:right;">
-0.272
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-15
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-14
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-13
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-12
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-09
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-08
</td>
<td style="text-align:right;">
-0.272
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-07
</td>
<td style="text-align:right;">
-0.272
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-06
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-05
</td>
<td style="text-align:right;">
-0.272
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-02
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-03-01
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-28
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-27
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-26
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-23
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-22
</td>
<td style="text-align:right;">
-0.270
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-21
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-20
</td>
<td style="text-align:right;">
-0.273
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-19
</td>
<td style="text-align:right;">
-0.274
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-16
</td>
<td style="text-align:right;">
-0.274
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-15
</td>
<td style="text-align:right;">
-0.276
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-14
</td>
<td style="text-align:right;">
-0.276
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-13
</td>
<td style="text-align:right;">
-0.276
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-12
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-09
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-08
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-07
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-06
</td>
<td style="text-align:right;">
-0.279
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-05
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-02
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-02-01
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-31
</td>
<td style="text-align:right;">
-0.279
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-30
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-29
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-26
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-25
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-24
</td>
<td style="text-align:right;">
-0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-23
</td>
<td style="text-align:right;">
-0.276
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-22
</td>
<td style="text-align:right;">
-0.277
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-19
</td>
<td style="text-align:right;">
-0.276
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-18
</td>
<td style="text-align:right;">
-0.275
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-17
</td>
<td style="text-align:right;">
-0.274
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-16
</td>
<td style="text-align:right;">
-0.272
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-15
</td>
<td style="text-align:right;">
-0.274
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-12
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-11
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-10
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-09
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-08
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-05
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-04
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-03
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
2018-01-02
</td>
<td style="text-align:right;">
-0.271
</td>
</tr>
</tbody>
</table>
</div>
<p>We now have to incorporate this code into the overall coding strategy described
in the <a href="https://www.curiousfrm.com/2019/04/real-world-tidy-interest-rate-swap-pricing/">previous post</a></p>
<p>Before we dive in how I coded this, let’s see how I changed the data structure of
how a swap is defined:</p>
<pre class="r"><code>swap.25y &lt;- list(notional = 10000000,
                  start.date = lubridate::ymd(20070119),
                  maturity.date = lubridate::ymd(20320119), 
                  strike = 0.00059820,
                  type = &quot;receiver&quot;, 
                  time.unit = list(pay = 6, receive = 12), 
                  dcc = list(pay = 0, receive = 6), 
                  calendar = &quot;TARGET&quot;)</code></pre>
<p>This new data structure now allows to define - as it should be - different
characteristics (like coupon frequency or day count convention) for the different
legs (<code>payer</code> and <code>receiver</code>) of the swap. In particular, we can specify in the
<code>type</code> variable whether the swap is a receiver or a payer one.</p>
<p>Let’s look atthe code now. The function that gets modified the most is the
<code>SwapCashflowYFCalculation</code> which I have re-named as <code>CashFlowPricing</code> one
which now looks as follows:</p>
<pre class="r"><code>CashFlowPricing  &lt;- function(today, start.date, maturity.date, type,
                                     time.unit, dcc, calendar) {
  # Part 1: Calculate the whole cashflow dates
  cashflows &lt;- seq(from = 0,
                   to = (lubridate::year(maturity.date) -
                           lubridate::year(start.date)) * 12,
                   by = time.unit) %&gt;%
    purrr::map_dbl(~RQuantLib::advance(calendar = calendar,
                                       dates = start.date,
                                       n = .x,
                                       timeUnit = 2,
                                       bdc = 1,
                                       emr = TRUE)) %&gt;%
    lubridate::as_date() %&gt;%
    {if (start.date &lt; today) append(today, .) else .}

  # Part 2: calculate accrual and rate fixing days
  accrual.date &lt;- cashflows[today - cashflows &gt; 0]

  if (!identical(as.double(accrual.date), double(0))) {
    accrual.date  %&lt;&gt;%  max()
    if (stringr::str_detect(type, &quot;floating&quot;)) {
      fixing.date &lt;- accrual.date %&gt;%
        {RQuantLib::advance(calendar = calendar,
                            dates = .,
                            n = -2,
                            timeUnit = 0,
                            bdc = 1,
                            emr = TRUE)}
    } else {
      fixing.date &lt;- NULL
    }
    accrual.yf &lt;- accrual.date %&gt;%
      {RQuantLib::yearFraction(today, ., dcc)} %&gt;%
      `*`(-1)
  } else {
    fixing.date &lt;- NULL
    accrual.yf &lt;- 0
  }

  # Part 3: Tidy and return the list of relevant dates
  cashflows %&lt;&gt;%
    purrr::map_dbl(~RQuantLib::yearFraction(today, .x, dcc)) %&gt;%
    tibble::tibble(yf = .) %&gt;%
    dplyr::filter(yf &gt;= 0)

  return(list(cashflows = cashflows, accrual.yf = accrual.yf,
              fixing.date = fixing.date))
}</code></pre>
<p>Let’s analyise the code:</p>
<ul>
<li><p>Part 1 is actually the core of the code previously described</p></li>
<li><p>Part 2 is the new code. <code>accrual.date</code> is the date from which the accrual starts
to be calculated. This gets converted into a year fraction and saved into <code>accrual.yf</code>.
The if statement calculates the date at which the floating EURIBOR rate has to
be snapped from Quandl only for the floating rate. This date is stored in the
<code>fixing.date</code> variable and it considers a 2 days lag which is standard for the
European market.</p></li>
<li><p>Part 3 finally converts and returns all the future cashflows in terms of
year fraction</p></li>
</ul>
<p>You can note that we now calculate the cashflows for the floating leg even if
it will note be used by the <code>OLDParSwapRate</code> function. This will be needed for
future developments when we will introduce the OIS discounting…(stay tuned!!)</p>
<p>I can now calculate the accrual and for this purpose I developed a brand new function
called <code>CalculateAccrual</code></p>
<pre class="r"><code>CalculateAccrual &lt;- function(swap.dates, leg.type, swap, direction) {
  # Part 1: calculate the accrual rate
  if (!is.null(swap.dates$fixing.date)) {
    rate &lt;- Quandl::Quandl(&quot;BOF/QS_D_IEUTIO6M&quot;,
                           start_date = swap.dates$fixing.date,
                           end_date = swap.dates$fixing.date) %&gt;%
      tibble::as_tibble(.) %&gt;%
      dplyr::select(Value) %&gt;%
      as.double %&gt;%
      `/`(100)
  } else {
    rate &lt;- swap$strike
  }
  # Part 2: Calculate the value of the accrual
  swap.dates %&gt;%
    purrr::pluck(&quot;accrual.yf&quot;) %&gt;%
    `*`(swap$notional * rate * switch(leg.type, &quot;pay&quot; = -1, &quot;receive&quot; = 1))
}</code></pre>
<p>This is smaller and easier function:</p>
<ul>
<li><p>Part 1: for floating legs we use Quandl to download the needed data and extract
the rate information. For the fixed one, we just use the strike of the swap.</p></li>
<li><p>Part 2: we calculate the actual accrual amount using the classical function</p></li>
</ul>
<p>Let’s see the final result on the 25 years’ swap we use as test:</p>
<pre><code>## # A tibble: 1 x 8
##   swap.id currency clean.mv dirty.mv accrual.pay accrual.receive     par
##   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;   &lt;dbl&gt;
## 1 Swap 2… EUR      -881815. -874994.       5441.           1379. 0.00771
## # … with 1 more variable: pv01 &lt;dbl&gt;</code></pre>
<p>Let’s compare the result with the Bloomberg screenshot</p>
<p><img src="/post/2019-07-08-downloading-variable-rate_files/Pricing%2025yrs%20floating.png" />
You can see that we now perfectly price also the receiving accrual and, of course,
also the total one.</p>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/coding/">Coding</a>

  <a class="tag tag--primary tag--small" href="/tags/interest-rates/">Interest Rates</a>

  <a class="tag tag--primary tag--small" href="/tags/r/">R</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2019/07/swappricer-is-on-github/" data-tooltip="SwapPricer is on Github">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2019/04/real-world-tidy-interest-rate-swap-pricing/" data-tooltip="Real world tidy interest rate swap pricing">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2019/07/downloading-variable-rate/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2019/07/downloading-variable-rate/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2019 <a href="https://github.com/DavideMagno">Davide Magno</a>. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2019/07/swappricer-is-on-github/" data-tooltip="SwapPricer is on Github">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2019/04/real-world-tidy-interest-rate-swap-pricing/" data-tooltip="Real world tidy interest rate swap pricing">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2019/07/downloading-variable-rate/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2019/07/downloading-variable-rate/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=%2F2019%2F07%2Fdownloading-variable-rate%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=%2F2019%2F07%2Fdownloading-variable-rate%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/c1105417b6cb80bccd4bb80937e0ec69?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Davide Magno</h4>
    
      <div id="about-card-bio">An Italian coding, tech, financial math professional and running lover</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Head of Financial Risk Management
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Dublin, Ireland
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/09/multicurrency-swap-pricing/">
                <h3 class="media-heading">Multi Currency Swap Pricing with SwapPricer</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">## ## checking for file ‘/private/var/folders/hf/3zd2l68s4xv13k7rbf1k51xw0000gn/T/RtmpZJz55Z/remotesa7a54189936/DavideMagno-SwapPricer-6cadd22/DESCRIPTION’ ... ✔ checking for file ‘/private/var/folders/hf/3zd2l68s4xv13k7rbf1k51xw0000gn/T/RtmpZJz55Z/remotesa7a54189936/DavideMagno-SwapPricer-6cadd22/DESCRIPTION’ ## ─ preparing ‘SwapPricer’: ## checking DESCRIPTION meta-information ... ✔ checking DESCRIPTION meta-information ## ─ checking for LF line-endings in source and make files and shell scripts ## ─ checking for empty or unneeded directories ## ─ looking to see if a ‘data/datalist’ file should be added ## ─ building ‘SwapPricer_1.0.2.tar.gz’ ## ##  I have released a new version of the package SwapPricer on GitHub here.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/07/swappricer-is-on-github/">
                <h3 class="media-heading">SwapPricer is on Github</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">In the previous posts we have seen how easy it is to price interest rate swaps using R. I am honoured to announce that I have decided to put all the functions I have described together into a package that is called…SwapPricer!
Ok, the name is not super original, but it should at least be easy to remember.
You can install it as follows:</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/07/downloading-variable-rate/">
                <h3 class="media-heading">Pricing floating legs of interest rate swaps</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">In this post we will close the trilogy on (old style) swap pricing. In particular, we will look at how downloading the data for the variable rate needed to calculate the variable leg accrual.
 Part 1 gave the general idea behind tidy pricing interest rate swaps using a 7 lines pipe
 Part 2 went much more into detail and priced some real world contract comparing the results obtained vs Bloomberg and showing significantly good results.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/04/real-world-tidy-interest-rate-swap-pricing/">
                <h3 class="media-heading">Real world tidy interest rate swap pricing</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">In this post I will show how easy is to price a portfolio of swaps leveraging the purrr package and given the swap pricing functions that we introduced in a previous post. I will do this in a “real world” environment hence using real market data as per the last 14th of April.
Import the discount factors from Bloomberg Let’s start the pricing of the swap portfolio with purrr by loading from an external source the EUR discount factor curve.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/03/using-the-tidyverse-for-swap-pricing/">
                <h3 class="media-heading">Using the tidyverse for swap pricing</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Introduction I am a big passionate of the tidyverse packages: I think they make the code very clean and clear. In particular, I like the lubridate packages for managing and making operations with dates but its major drawback is that it doesn’t manage financial holidays, which are key when projecting financial cashflows linked to instruments like interest rte swaps.
In this case, I prefer to use the RQuantLib package.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/02/us-federal-spending-analysis/">
                <h3 class="media-heading">US Federal Spending Analysis</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">This week&#39;s #TidyTuesday is about federal spending. I was interested in understanding if spending had shifted towards clean energy sub-agencies in the last 20 years. Spoiler alert: unfortunately no! 😰#Rstats #tidyverse cc @thomas_mock @R4DScommunity pic.twitter.com/AbQzheSagU
&mdash; Davide Magno (@DavideMagno) February 12, 2019  </div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/02/geospatial-analysis-on-housing-price-index/">
                <h3 class="media-heading">Geospatial Analysis on Housing Price Index</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Here&#39;s my #TidyTuesday submission.I studied the total increase in the housing index for each US State compared to the US federal index. No surprise in California house price has increased much more than the rest of US.The #mapdata library was 👍🏼@thomas_mock @R4DScommunity #rstats pic.twitter.com/sYI1zKhIpC
&mdash; Davide Magno (@DavideMagno) February 10, 2019  </div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/02/my-first-tidytuesday-submission/">
                <h3 class="media-heading">My First #TidyTuesday Submission</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Finally my first #TidyTuesday submission! 🎊🎉I am starting from week 1 2019 but I will catch up soon😉When do people submit their visualisations?Mostly on Tuesday and Wednesday afternoon, but also on Monday before the new set is released #rstats #ggplot @rstats4ds @thomas_mock pic.twitter.com/pKZAyL8vp1
&mdash; Davide Magno (@DavideMagno) February 3, 2019  </div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/02/convert-foreign-currency-valuations/">
                <h3 class="media-heading">Convert foreign currency valuations</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">One of the most common problems when dealign with financial data is to have assets (or liabilities) denominated in a currency that is different from the domestic one.
I propose a tidy solution to this problem that involves no use of for cycles.
The principle of the solution is that converting each currency can be done in parallel using the map function while the consolidation of the results will be done using the reduce logic.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/01/generate-scenarios-correlated-to-existing-ones/">
                <h3 class="media-heading">Generate scenarios correlated to existing ones</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">In quantitative finance we often look at simulations of some market risk factors like equity returns or interest rate changes.
There are many third party companies who specialize in the historical calibration of such variables and provide simulations of future expected outcomes to the companies who require them.
For example, let’s suppose that we receive the expected returns of the Google shares as per the following distribution
# This modelling is given by the third party and in theory we don&#39;t know it google &lt;- rnorm(10000, mean = 0.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         10 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('/images/celestino.png');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = '\/2019\/07\/downloading-variable-rate\/';
          
            this.page.identifier = '\/2019\/07\/downloading-variable-rate\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'curiousfrm';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    
  </body>
</html>

